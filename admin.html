<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å | –°–∏—Å—Ç–µ–º–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–≥—Ä—É–∂–µ–Ω–∏–π</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --primary-light: #dbeafe;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
            --gray-50: #f8fafc;
            --gray-100: #f1f5f9;
            --gray-200: #e2e8f0;
            --gray-300: #cbd5e1;
            --gray-400: #94a3b8;
            --gray-500: #64748b;
            --gray-600: #475569;
            --gray-700: #334155;
            --gray-800: #1e293b;
            --gray-900: #0f172a;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--gray-100);
            color: var(--gray-800);
            min-height: 100vh;
        }
        
        /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
        .container {
            display: grid;
            grid-template-columns: 250px 1fr;
            min-height: 100vh;
        }
        
        /* –°–∞–π–¥–±–∞—Ä */
        .sidebar {
            background: linear-gradient(180deg, var(--gray-900) 0%, var(--gray-800) 100%);
            color: white;
            padding: 30px 20px;
            position: sticky;
            top: 0;
            height: 100vh;
            overflow-y: auto;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .logo-icon {
            font-size: 2.5rem;
            color: var(--primary);
        }
        
        .logo h1 {
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .logo span {
            display: block;
            font-size: 0.8rem;
            opacity: 0.7;
            margin-top: 5px;
        }
        
        .nav-section {
            margin-bottom: 30px;
        }
        
        .nav-title {
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--gray-400);
            margin-bottom: 15px;
            padding-left: 15px;
        }
        
        .nav-links {
            list-style: none;
        }
        
        .nav-links li {
            margin-bottom: 8px;
        }
        
        .nav-links a {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            color: var(--gray-300);
            text-decoration: none;
            border-radius: 10px;
            transition: all 0.3s;
        }
        
        .nav-links a:hover,
        .nav-links a.active {
            background: rgba(37, 99, 235, 0.2);
            color: white;
        }
        
        .nav-links i {
            width: 20px;
            text-align: center;
        }
        
        .system-status {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-top: 30px;
            border-left: 4px solid var(--success);
        }
        
        .status-line {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--success);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç */
        .main-content {
            padding: 0;
            overflow-x: hidden;
        }
        
        /* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å */
        .top-bar {
            background: white;
            padding: 20px 30px;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .top-bar h2 {
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-menu {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(37, 99, 235, 0.3);
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-warning {
            background: var(--warning);
            color: white;
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid var(--gray-300);
            color: var(--gray-700);
        }
        
        /* –°–æ–¥–µ—Ä–∂–∏–º–æ–µ */
        .content {
            padding: 30px;
        }
        
        /* –ö–∞—Ä—Ç–æ—á–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--gray-200);
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
        }
        
        .stat-icon.blue { background: var(--primary-light); color: var(--primary); }
        .stat-icon.green { background: #d1fae5; color: var(--success); }
        .stat-icon.orange { background: #fef3c7; color: var(--warning); }
        .stat-icon.purple { background: #e0e7ff; color: #6366f1; }
        
        .stat-trend {
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .trend-up { color: var(--success); }
        .trend-down { color: var(--danger); }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            margin: 10px 0;
            color: var(--gray-900);
        }
        
        .stat-label {
            color: var(--gray-600);
            font-size: 0.95rem;
        }
        
        /* –§–∏–ª—å—Ç—Ä—ã */
        .filters-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
        }
        
        .filters-title {
            font-size: 1.3rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--gray-800);
        }
        
        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .filter-group {
            margin-bottom: 0;
        }
        
        .filter-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--gray-700);
            font-size: 0.9rem;
        }
        
        .filter-group input,
        .filter-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--gray-200);
            border-radius: 8px;
            font-size: 0.95rem;
            transition: all 0.3s;
        }
        
        .filter-group input:focus,
        .filter-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        .filter-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        /* –¢–∞–±–ª–∏—Ü–∞ */
        .table-container {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
        }
        
        .table-header {
            padding: 20px 25px;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--gray-50);
        }
        
        .table-header h3 {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .table-actions {
            display: flex;
            gap: 10px;
        }
        
        .table-wrapper {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1000px;
        }
        
        thead {
            background: var(--gray-50);
        }
        
        th {
            padding: 18px 15px;
            text-align: left;
            font-weight: 600;
            color: var(--gray-700);
            border-bottom: 2px solid var(--gray-200);
            white-space: nowrap;
        }
        
        td {
            padding: 16px 15px;
            border-bottom: 1px solid var(--gray-200);
            vertical-align: middle;
        }
        
        tbody tr {
            transition: background 0.2s;
        }
        
        tbody tr:hover {
            background: var(--gray-50);
        }
        
        /* –ë–µ–π–¥–∂–∏ */
        .badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            text-align: center;
            min-width: 80px;
        }
        
        .badge-slot {
            color: white;
        }
        
        .slot-morning { background: linear-gradient(135deg, #3b82f6, #1d4ed8); }
        .slot-afternoon { background: linear-gradient(135deg, #10b981, #059669); }
        .slot-evening { background: linear-gradient(135deg, #f59e0b, #d97706); }
        
        .badge-agent {
            background: var(--primary-light);
            color: var(--primary);
        }
        
        .badge-seats {
            background: #f0f9ff;
            color: #0369a1;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        /* –ü–∞–≥–∏–Ω–∞—Ü–∏—è */
        .pagination {
            padding: 20px 25px;
            border-top: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--gray-50);
        }
        
        .page-info {
            color: var(--gray-600);
        }
        
        .page-controls {
            display: flex;
            gap: 10px;
        }
        
        .page-btn {
            padding: 8px 15px;
            background: white;
            border: 1px solid var(--gray-300);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .page-btn:hover:not(:disabled) {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .page-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        /* –ì—Ä–∞—Ñ–∏–∫–∏ */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .chart-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .chart-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--gray-800);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
        
        /* –≠–∫—Å–ø–æ—Ä—Ç */
        .export-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .export-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .export-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .export-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray-500);
        }
        
        .export-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .export-option {
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .export-option:hover,
        .export-option.active {
            border-color: var(--primary);
            background: var(--primary-light);
        }
        
        .export-option i {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: var(--primary);
        }
        
        .date-range {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        /* –°–æ–æ–±—â–µ–Ω–∏—è */
        .message {
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }
        
        .message.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #10b981;
            display: block;
        }
        
        .message.error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #ef4444;
            display: block;
        }
        
        /* –ó–∞–≥—Ä—É–∑–∫–∞ */
        .loading {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray-500);
        }
        
        .loader {
            width: 50px;
            height: 50px;
            border: 5px solid var(--gray-200);
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                display: none;
            }
            
            .mobile-menu-btn {
                display: block;
            }
        }
        
        @media (max-width: 768px) {
            .content {
                padding: 20px;
            }
            
            .top-bar {
                padding: 15px 20px;
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .filters-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .filter-actions {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .table-actions {
                flex-wrap: wrap;
            }
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        .fade-in {
            animation: fadeIn 0.5s ease;
        }
        
        .slide-down {
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* –ö–∞—Å—Ç–æ–º–Ω—ã–π —Å–∫—Ä–æ–ª–ª */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--gray-100);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--gray-300);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--gray-400);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –°–∞–π–¥–±–∞—Ä -->
        <aside class="sidebar">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-water"></i>
                </div>
                <div>
                    <h1>Diving Admin</h1>
                    <span>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</span>
                </div>
            </div>
            
            <div class="nav-section">
                <h3 class="nav-title">–û—Å–Ω–æ–≤–Ω–æ–µ</h3>
                <ul class="nav-links">
                    <li><a href="#" class="active"><i class="fas fa-tachometer-alt"></i> –û–±–∑–æ—Ä</a></li>
                    <li><a href="#"><i class="fas fa-calendar-alt"></i> –ö–∞–ª–µ–Ω–¥–∞—Ä—å</a></li>
                    <li><a href="#"><i class="fas fa-users"></i> –ê–≥–µ–Ω—Ç—ã</a></li>
                    <li><a href="#"><i class="fas fa-chart-bar"></i> –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</a></li>
                </ul>
            </div>
            
            <div class="nav-section">
                <h3 class="nav-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h3>
                <ul class="nav-links">
                    <li><a href="#"><i class="fas fa-file-export"></i> –≠–∫—Å–ø–æ—Ä—Ç –æ—Ç—á–µ—Ç–æ–≤</a></li>
                    <li><a href="#"><i class="fas fa-cog"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏</a></li>
                    <li><a href="#"><i class="fas fa-history"></i> –ò—Å—Ç–æ—Ä–∏—è –¥–µ–π—Å—Ç–≤–∏–π</a></li>
                </ul>
            </div>
            
            <div class="nav-section">
                <h3 class="nav-title">–°–µ—Ä–≤–∏—Å</h3>
                <ul class="nav-links">
                    <li><a href="index.html" target="_blank"><i class="fas fa-plus-circle"></i> –ù–æ–≤–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</a></li>
                    <li><a href="#"><i class="fas fa-question-circle"></i> –ü–æ–º–æ—â—å</a></li>
                    <li><a href="#"><i class="fas fa-envelope"></i> –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å</a></li>
                </ul>
            </div>
            
            <div class="system-status">
                <div class="status-line">
                    <div class="status-dot" id="status-dot"></div>
                    <span id="status-text">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...</span>
                </div>
                <div style="font-size: 0.85rem; opacity: 0.8; margin-top: 10px;">
                    <div>–û–±–Ω–æ–≤–ª–µ–Ω–æ: <span id="last-update">--:--:--</span></div>
                    <div>–ó–∞–ø–∏—Å–µ–π: <span id="total-records">0</span></div>
                </div>
            </div>
        </aside>
        
        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <main class="main-content">
            <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å -->
            <div class="top-bar">
                <h2><i class="fas fa-tachometer-alt"></i> –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π</h2>
                <div class="user-menu">
                    <button class="btn btn-outline" onclick="refreshData()">
                        <i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏—Ç—å
                    </button>
                    <button class="btn btn-primary" onclick="openExportModal()">
                        <i class="fas fa-file-export"></i> –≠–∫—Å–ø–æ—Ä—Ç –æ—Ç—á–µ—Ç–∞
                    </button>
                    <button class="btn btn-success" onclick="window.open('index.html', '_blank')">
                        <i class="fas fa-plus"></i> –ù–æ–≤–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
                    </button>
                </div>
            </div>
            
            <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
            <div class="message" id="message"></div>
            
            <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
            <div class="content">
                <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
                <div class="stats-grid" id="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon blue">
                                <i class="fas fa-calendar-check"></i>
                            </div>
                            <div class="stat-trend trend-up">
                                <i class="fas fa-arrow-up"></i> 12%
                            </div>
                        </div>
                        <div class="stat-value" id="stat-total">0</div>
                        <div class="stat-label">–í—Å–µ–≥–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon green">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-trend trend-up">
                                <i class="fas fa-arrow-up"></i> 5%
                            </div>
                        </div>
                        <div class="stat-value" id="stat-today">0</div>
                        <div class="stat-label">–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π —Å–µ–≥–æ–¥–Ω—è</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon orange">
                                <i class="fas fa-user-tie"></i>
                            </div>
                            <div class="stat-trend trend-up">
                                <i class="fas fa-arrow-up"></i> 3%
                            </div>
                        </div>
                        <div class="stat-value" id="stat-agents">0</div>
                        <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon purple">
                                <i class="fas fa-chair"></i>
                            </div>
                            <div class="stat-trend trend-up">
                                <i class="fas fa-arrow-up"></i> 8%
                            </div>
                        </div>
                        <div class="stat-value" id="stat-seats">0</div>
                        <div class="stat-label">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–æ –º–µ—Å—Ç</div>
                    </div>
                </div>
                
                <!-- –ì—Ä–∞—Ñ–∏–∫–∏ -->
                <div class="charts-grid" id="charts-container" style="display: none;">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title"><i class="fas fa-chart-line"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –¥–Ω—è–º</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="dailyChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title"><i class="fas fa-chart-pie"></i> –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å–ª–æ—Ç–∞–º</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="slotsChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- –§–∏–ª—å—Ç—Ä—ã -->
                <div class="filters-card">
                    <h3 class="filters-title"><i class="fas fa-filter"></i> –§–∏–ª—å—Ç—Ä—ã –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π</h3>
                    <div class="filters-grid">
                        <div class="filter-group">
                            <label><i class="fas fa-calendar"></i> –î–∞—Ç–∞ –æ—Ç</label>
                            <input type="date" id="filter-date-from">
                        </div>
                        
                        <div class="filter-group">
                            <label><i class="fas fa-calendar"></i> –î–∞—Ç–∞ –¥–æ</label>
                            <input type="date" id="filter-date-to">
                        </div>
                        
                        <div class="filter-group">
                            <label><i class="fas fa-user-tie"></i> –ê–≥–µ–Ω—Ç</label>
                            <select id="filter-agent">
                                <option value="">–í—Å–µ –∞–≥–µ–Ω—Ç—ã</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label><i class="fas fa-clock"></i> –í—Ä–µ–º–µ–Ω–Ω–æ–π —Å–ª–æ—Ç</label>
                            <select id="filter-slot">
                                <option value="">–í—Å–µ —Å–ª–æ—Ç—ã</option>
                                <option value="morning">–£—Ç—Ä–æ (9:00-12:00)</option>
                                <option value="afternoon">–î–µ–Ω—å (12:00-16:00)</option>
                                <option value="evening">–í–µ—á–µ—Ä (16:00-20:00)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="filter-actions">
                        <button class="btn btn-primary" onclick="applyFilters()">
                            <i class="fas fa-search"></i> –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
                        </button>
                        <button class="btn btn-outline" onclick="resetFilters()">
                            <i class="fas fa-eraser"></i> –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
                        </button>
                        <button class="btn btn-outline" onclick="toggleCharts()">
                            <i class="fas fa-chart-bar"></i> –ü–æ–∫–∞–∑–∞—Ç—å –≥—Ä–∞—Ñ–∏–∫–∏
                        </button>
                    </div>
                </div>
                
                <!-- –¢–∞–±–ª–∏—Ü–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π -->
                <div class="table-container">
                    <div class="table-header">
                        <h3><i class="fas fa-table"></i> –°–ø–∏—Å–æ–∫ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π</h3>
                        <div class="table-actions">
                            <button class="btn btn-outline" onclick="exportCurrentData()">
                                <i class="fas fa-download"></i> –≠–∫—Å–ø–æ—Ä—Ç —Ç–∞–±–ª–∏—Ü—ã
                            </button>
                            <button class="btn btn-outline" onclick="deleteSelected()" id="delete-btn" disabled>
                                <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-wrapper">
                        <table id="bookings-table">
                            <thead>
                                <tr>
                                    <th width="50">
                                        <input type="checkbox" id="select-all" onchange="toggleSelectAll(this)">
                                    </th>
                                    <th width="120">–î–∞—Ç–∞</th>
                                    <th width="100">–°–ª–æ—Ç</th>
                                    <th width="150">–ê–≥–µ–Ω—Ç</th>
                                    <th width="150">–ö–ª–∏–µ–Ω—Ç</th>
                                    <th width="120">–¢–µ–ª–µ—Ñ–æ–Ω</th>
                                    <th width="80">–ú–µ—Å—Ç</th>
                                    <th>–ü—Ä–∏–º–µ—á–∞–Ω–∏—è</th>
                                    <th width="150">–°–æ–∑–¥–∞–Ω–æ</th>
                                    <th width="100">–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody id="bookings-body">
                                <tr>
                                    <td colspan="10" class="loading">
                                        <div class="loader"></div>
                                        <p>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="pagination">
                        <div class="page-info">
                            –ü–æ–∫–∞–∑–∞–Ω–æ <span id="page-start">0</span>-<span id="page-end">0</span> –∏–∑ <span id="total-count">0</span> –∑–∞–ø–∏—Å–µ–π
                        </div>
                        <div class="page-controls">
                            <button class="page-btn" onclick="changePage(-1)" id="prev-btn" disabled>
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button class="page-btn active" onclick="changePage(1)">1</button>
                            <button class="page-btn" onclick="changePage(2)">2</button>
                            <button class="page-btn" onclick="changePage(3)">3</button>
                            <button class="page-btn" onclick="changePage(4)">4</button>
                            <button class="page-btn" onclick="changePage(5)">5</button>
                            <button class="page-btn" onclick="changePage(1)" id="next-btn">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∞ -->
    <div class="export-modal" id="export-modal">
        <div class="export-content">
            <div class="export-header">
                <h2><i class="fas fa-file-export"></i> –≠–∫—Å–ø–æ—Ä—Ç –æ—Ç—á–µ—Ç–∞</h2>
                <button class="export-close" onclick="closeExportModal()">&times;</button>
            </div>
            
            <div class="export-options">
                <div class="export-option" onclick="selectExportOption('today')">
                    <i class="fas fa-calendar-day"></i>
                    <h3>–ó–∞ —Å–µ–≥–æ–¥–Ω—è</h3>
                    <p>–≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –∑–∞ —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –¥–µ–Ω—å</p>
                </div>
                
                <div class="export-option" onclick="selectExportOption('week')">
                    <i class="fas fa-calendar-week"></i>
                    <h3>–ó–∞ –Ω–µ–¥–µ–ª—é</h3>
                    <p>–≠–∫—Å–ø–æ—Ä—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π</p>
                </div>
                
                <div class="export-option" onclick="selectExportOption('month')">
                    <i class="fas fa-calendar-alt"></i>
                    <h3>–ó–∞ –º–µ—Å—è—Ü</h3>
                    <p>–≠–∫—Å–ø–æ—Ä—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü</p>
                </div>
                
                <div class="export-option" onclick="selectExportOption('custom')">
                    <i class="fas fa-calendar"></i>
                    <h3>–ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥</h3>
                    <p>–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞—á–∞–ª—å–Ω—É—é –∏ –∫–æ–Ω–µ—á–Ω—É—é –¥–∞—Ç—É</p>
                </div>
            </div>
            
            <div class="date-range" id="date-range-picker" style="display: none;">
                <div class="filter-group">
                    <label>–î–∞—Ç–∞ –æ—Ç:</label>
                    <input type="date" id="export-date-from">
                </div>
                <div class="filter-group">
                    <label>–î–∞—Ç–∞ –¥–æ:</label>
                    <input type="date" id="export-date-to">
                </div>
            </div>
            
            <div class="filter-group">
                <label>–§–æ—Ä–º–∞—Ç —ç–∫—Å–ø–æ—Ä—Ç–∞:</label>
                <select id="export-format">
                    <option value="excel">Excel (.xlsx)</option>
                    <option value="csv">CSV (.csv)</option>
                    <option value="pdf">PDF (.pdf) - –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</option>
                </select>
            </div>
            
            <div style="display: flex; gap: 15px; margin-top: 30px;">
                <button class="btn btn-primary" style="flex: 1;" onclick="generateExport()">
                    <i class="fas fa-download"></i> –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏ —Å–∫–∞—á–∞—Ç—å
                </button>
                <button class="btn btn-outline" onclick="closeExportModal()">
                    –û—Ç–º–µ–Ω–∞
                </button>
            </div>
        </div>
    </div>

    <script>
        // === –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø SUPABASE ===
        const SUPABASE_URL = 'https://ftrkosudfbdhzsfpqklf.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_8jp3h0PAv9FPE6Riw3gBOw_9NCjWacu';
        
        let supabase;
        let currentPage = 1;
        const pageSize = 20;
        let totalBookings = 0;
        let allBookings = [];
        let filteredBookings = [];
        let currentFilters = {};
        let charts = {};
        let selectedExportOption = 'today';

        // === –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ===
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('üöÄ –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è...');
            
            try {
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Supabase
                supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
                await checkConnection();
                
                // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
                setupInitialValues();
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                await loadData();
                
                console.log('‚úÖ –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ');
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
                showMessage('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.', 'error');
            }
        });

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
        async function checkConnection() {
            updateStatus('–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...', 'connecting');
            
            try {
                const { data, error } = await supabase
                    .from('bookings')
                    .select('count')
                    .limit(1);
                
                if (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:', error);
                    updateStatus('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è', 'disconnected');
                    showMessage('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Supabase.', 'error');
                } else {
                    updateStatus('–ü–æ–¥–∫–ª—é—á–µ–Ω–æ', 'connected');
                }
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏:', error);
                updateStatus('–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è', 'disconnected');
                showMessage('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.', 'error');
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
        function updateStatus(text, status) {
            document.getElementById('status-text').textContent = text;
            const dot = document.getElementById('status-dot');
            dot.className = 'status-dot ' + status;
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞—á–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
        function setupInitialValues() {
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–∞—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π)
            const today = new Date();
            const thirtyDaysAgo = new Date();
            thirtyDaysAgo.setDate(today.getDate() - 30);
            
            document.getElementById('filter-date-from').value = formatDateForInput(thirtyDaysAgo);
            document.getElementById('filter-date-to').value = formatDateForInput(today);
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–∞—Ç—ã –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞
            document.getElementById('export-date-from').value = formatDateForInput(thirtyDaysAgo);
            document.getElementById('export-date-to').value = formatDateForInput(today);
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –∞–≥–µ–Ω—Ç–æ–≤
            loadAgents();
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã –¥–ª—è input
        function formatDateForInput(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –∞–≥–µ–Ω—Ç–æ–≤
        async function loadAgents() {
            try {
                const { data, error } = await supabase
                    .from('bookings')
                    .select('agent_code, agent_name')
                    .order('agent_name');
                
                if (error) throw error;
                
                const agentSelect = document.getElementById('filter-agent');
                const uniqueAgents = new Map();
                
                if (data && data.length > 0) {
                    data.forEach(booking => {
                        if (booking.agent_code && !uniqueAgents.has(booking.agent_code)) {
                            uniqueAgents.set(booking.agent_code, booking.agent_name);
                        }
                    });
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –∞–≥–µ–Ω—Ç–æ–≤ –≤ select
                    uniqueAgents.forEach((name, code) => {
                        const option = document.createElement('option');
                        option.value = code;
                        option.textContent = `${name} (${code})`;
                        agentSelect.appendChild(option);
                    });
                }
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–≥–µ–Ω—Ç–æ–≤:', error);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        async function loadData() {
            showLoading(true);
            
            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
                await loadBookings();
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                await loadStatistics();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                updateLastUpdateTime();
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                showMessage(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: ${error.message}`, 'error');
            } finally {
                showLoading(false);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
        async function loadBookings() {
            const tbody = document.getElementById('bookings-body');
            
            try {
                // –°–æ–±–∏—Ä–∞–µ–º —Ñ–∏–ª—å—Ç—Ä—ã
                const dateFrom = document.getElementById('filter-date-from').value;
                const dateTo = document.getElementById('filter-date-to').value;
                const agent = document.getElementById('filter-agent').value;
                const slot = document.getElementById('filter-slot').value;
                
                // –°—Ç—Ä–æ–∏–º –∑–∞–ø—Ä–æ—Å
                let query = supabase
                    .from('bookings')
                    .select('*', { count: 'exact' })
                    .order('booking_date', { ascending: false })
                    .order('created_at', { ascending: false });
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã
                if (dateFrom) {
                    query = query.gte('booking_date', dateFrom);
                }
                
                if (dateTo) {
                    query = query.lte('booking_date', dateTo);
                }
                
                if (agent) {
                    query = query.eq('agent_code', agent);
                }
                
                if (slot) {
                    query = query.eq('slot_time', slot);
                }
                
                const { data, count, error } = await query.range(
                    (currentPage - 1) * pageSize,
                    currentPage * pageSize - 1
                );
                
                if (error) throw error;
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
                allBookings = data || [];
                totalBookings = count || 0;
                filteredBookings = allBookings;
                
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                displayBookings();
                updatePagination();
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π:', error);
                tbody.innerHTML = `
                    <tr>
                        <td colspan="10" style="text-align: center; padding: 40px; color: var(--danger);">
                            <i class="fas fa-exclamation-triangle" style="font-size: 2rem; margin-bottom: 15px;"></i>
                            <h3>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</h3>
                            <p>${error.message}</p>
                            <button class="btn btn-primary" onclick="loadData()" style="margin-top: 20px;">
                                <i class="fas fa-redo"></i> –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
                            </button>
                        </td>
                    </tr>
                `;
            }
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –≤ —Ç–∞–±–ª–∏—Ü–µ
        function displayBookings() {
            const tbody = document.getElementById('bookings-body');
            
            if (!filteredBookings || filteredBookings.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="10" style="text-align: center; padding: 60px; color: var(--gray-500);">
                            <i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 20px; opacity: 0.5;"></i>
                            <h3 style="margin-bottom: 10px;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</h3>
                            <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            let html = '';
            
            filteredBookings.forEach((booking, index) => {
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è —Å–ª–æ—Ç–∞
                let slotClass = '';
                let slotText = '';
                
                switch(booking.slot_time) {
                    case 'morning':
                        slotClass = 'slot-morning';
                        slotText = '–£—Ç—Ä–æ';
                        break;
                    case 'afternoon':
                        slotClass = 'slot-afternoon';
                        slotText = '–î–µ–Ω—å';
                        break;
                    case 'evening':
                        slotClass = 'slot-evening';
                        slotText = '–í–µ—á–µ—Ä';
                        break;
                }
                
                // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—ã
                const bookingDate = new Date(booking.booking_date).toLocaleDateString('ru-RU');
                const createdDate = new Date(booking.created_at).toLocaleString('ru-RU', {
                    day: '2-digit',
                    month: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                // –û–±—Ä–µ–∑–∞–µ–º –¥–ª–∏–Ω–Ω—ã–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏—è
                const notes = booking.client_notes || '';
                const shortNotes = notes.length > 50 ? notes.substring(0, 50) + '...' : notes;
                
                html += `
                    <tr class="fade-in" style="animation-delay: ${index * 0.05}s">
                        <td>
                            <input type="checkbox" class="booking-checkbox" value="${booking.id}" onchange="updateDeleteButton()">
                        </td>
                        <td><strong>${bookingDate}</strong></td>
                        <td><span class="badge badge-slot ${slotClass}">${slotText}</span></td>
                        <td>
                            <span class="badge badge-agent">${booking.agent_code}</span>
                            <div style="font-size: 0.85rem; margin-top: 5px; color: var(--gray-600);">
                                ${booking.agent_name}
                            </div>
                        </td>
                        <td>
                            <strong>${booking.client_name}</strong>
                            ${booking.client_address ? 
                                `<div style="font-size: 0.85rem; color: var(--gray-600); margin-top: 5px;">
                                    <i class="fas fa-map-marker-alt"></i> ${booking.client_address}
                                </div>` : ''
                            }
                        </td>
                        <td><code>${formatPhone(booking.client_phone)}</code></td>
                        <td><span class="badge badge-seats">${booking.seats_count}</span></td>
                        <td title="${notes}">${shortNotes || '‚Äî'}</td>
                        <td><small>${createdDate}</small></td>
                        <td>
                            <button class="btn btn-outline" style="padding: 5px 10px; font-size: 0.8rem;" onclick="viewBooking('${booking.id}')">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-outline" style="padding: 5px 10px; font-size: 0.8rem; margin-left: 5px;" onclick="deleteBooking('${booking.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
        function formatPhone(phone) {
            if (!phone) return '‚Äî';
            const cleaned = phone.replace(/\D/g, '');
            if (cleaned.length === 11) {
                return `+7 (${cleaned.substring(1, 4)}) ${cleaned.substring(4, 7)}-${cleaned.substring(7, 9)}-${cleaned.substring(9, 11)}`;
            }
            return phone;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
        function updatePagination() {
            const totalPages = Math.ceil(totalBookings / pageSize);
            const start = (currentPage - 1) * pageSize + 1;
            const end = Math.min(currentPage * pageSize, totalBookings);
            
            document.getElementById('page-start').textContent = start;
            document.getElementById('page-end').textContent = end;
            document.getElementById('total-count').textContent = totalBookings;
            document.getElementById('total-records').textContent = totalBookings;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
            document.getElementById('prev-btn').disabled = currentPage === 1;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–æ–º–µ—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü
            const pageControls = document.querySelector('.page-controls');
            let pagesHtml = '';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–∞–∫—Å–∏–º—É–º 5 —Å—Ç—Ä–∞–Ω–∏—Ü
            let startPage = Math.max(1, currentPage - 2);
            let endPage = Math.min(totalPages, startPage + 4);
            
            if (endPage - startPage < 4) {
                startPage = Math.max(1, endPage - 4);
            }
            
            for (let i = startPage; i <= endPage; i++) {
                pagesHtml += `<button class="page-btn ${i === currentPage ? 'active' : ''}" onclick="changePage(${i})">${i}</button>`;
            }
            
            // –ó–∞–º–µ–Ω—è–µ–º –∫–Ω–æ–ø–∫–∏ —Å –Ω–æ–º–µ—Ä–∞–º–∏ —Å—Ç—Ä–∞–Ω–∏—Ü
            const pageBtns = pageControls.querySelectorAll('.page-btn:not(:first-child):not(:last-child)');
            pageBtns[0]?.parentNode?.innerHTML = `
                <button class="page-btn" onclick="changePage(-1)" id="prev-btn" ${currentPage === 1 ? 'disabled' : ''}>
                    <i class="fas fa-chevron-left"></i>
                </button>
                ${pagesHtml}
                <button class="page-btn" onclick="changePage(1)" id="next-btn" ${currentPage === totalPages ? 'disabled' : ''}>
                    <i class="fas fa-chevron-right"></i>
                </button>
            `;
        }

        // –°–º–µ–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        function changePage(page) {
            if (page === -1) {
                if (currentPage > 1) currentPage--;
            } else if (page === 1) {
                const totalPages = Math.ceil(totalBookings / pageSize);
                if (currentPage < totalPages) currentPage++;
            } else {
                currentPage = page;
            }
            
            loadBookings();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤
        function applyFilters() {
            currentPage = 1;
            loadBookings();
            loadStatistics();
        }

        // –°–±—Ä–æ—Å —Ñ–∏–ª—å—Ç—Ä–æ–≤
        function resetFilters() {
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
            const today = new Date();
            const thirtyDaysAgo = new Date();
            thirtyDaysAgo.setDate(today.getDate() - 30);
            
            document.getElementById('filter-date-from').value = formatDateForInput(thirtyDaysAgo);
            document.getElementById('filter-date-to').value = formatDateForInput(today);
            document.getElementById('filter-agent').value = '';
            document.getElementById('filter-slot').value = '';
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–±—Ä–æ—à–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
            applyFilters();
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        async function loadStatistics() {
            try {
                // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
                const { count: totalCount } = await supabase
                    .from('bookings')
                    .select('*', { count: 'exact', head: true });
                
                document.getElementById('stat-total').textContent = totalCount || 0;
                
                // –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
                const today = new Date().toISOString().split('T')[0];
                const { count: todayCount } = await supabase
                    .from('bookings')
                    .select('*', { count: 'exact', head: true })
                    .eq('booking_date', today);
                
                document.getElementById('stat-today').textContent = todayCount || 0;
                
                // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤
                const { data: agentsData } = await supabase
                    .from('bookings')
                    .select('agent_code');
                
                const uniqueAgents = new Set();
                if (agentsData) {
                    agentsData.forEach(b => uniqueAgents.add(b.agent_code));
                }
                document.getElementById('stat-agents').textContent = uniqueAgents.size;
                
                // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç
                const { data: bookingsData } = await supabase
                    .from('bookings')
                    .select('seats_count');
                
                let totalSeats = 0;
                if (bookingsData) {
                    totalSeats = bookingsData.reduce((sum, b) => sum + (b.seats_count || 0), 0);
                }
                document.getElementById('stat-seats').textContent = totalSeats;
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤
                await loadChartsData();
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤
        async function loadChartsData() {
            try {
                // –î–∞–Ω–Ω—ã–µ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ –ø–æ –¥–Ω—è–º
                const { data: dailyData } = await supabase
                    .from('bookings')
                    .select('booking_date, seats_count')
                    .gte('booking_date', new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0])
                    .order('booking_date', { ascending: true });
                
                if (dailyData && dailyData.length > 0) {
                    // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ
                    const dailyStats = {};
                    dailyData.forEach(booking => {
                        const date = booking.booking_date;
                        if (!dailyStats[date]) {
                            dailyStats[date] = {
                                bookings: 0,
                                seats: 0
                            };
                        }
                        dailyStats[date].bookings++;
                        dailyStats[date].seats += booking.seats_count || 0;
                    });
                    
                    const dates = Object.keys(dailyStats).sort();
                    const bookingsCount = dates.map(date => dailyStats[date].bookings);
                    const seatsCount = dates.map(date => dailyStats[date].seats);
                    
                    createDailyChart(dates, bookingsCount, seatsCount);
                }
                
                // –î–∞–Ω–Ω—ã–µ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ –ø–æ —Å–ª–æ—Ç–∞–º
                const { data: slotsData } = await supabase
                    .from('bookings')
                    .select('slot_time, seats_count');
                
                if (slotsData && slotsData.length > 0) {
                    const slotStats = {
                        morning: { bookings: 0, seats: 0 },
                        afternoon: { bookings: 0, seats: 0 },
                        evening: { bookings: 0, seats: 0 }
                    };
                    
                    slotsData.forEach(booking => {
                        const slot = booking.slot_time;
                        if (slotStats[slot]) {
                            slotStats[slot].bookings++;
                            slotStats[slot].seats += booking.seats_count || 0;
                        }
                    });
                    
                    const slotLabels = ['–£—Ç—Ä–æ', '–î–µ–Ω—å', '–í–µ—á–µ—Ä'];
                    const slotBookings = [
                        slotStats.morning.bookings,
                        slotStats.afternoon.bookings,
                        slotStats.evening.bookings
                    ];
                    const slotSeats = [
                        slotStats.morning.seats,
                        slotStats.afternoon.seats,
                        slotStats.evening.seats
                    ];
                    
                    createSlotsChart(slotLabels, slotBookings, slotSeats);
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏
                document.getElementById('charts-container').style.display = 'grid';
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–æ–≤:', error);
            }
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ –ø–æ –¥–Ω—è–º
        function createDailyChart(dates, bookingsCount, seatsCount) {
            const ctx = document.getElementById('dailyChart').getContext('2d');
            
            // –£–Ω–∏—á—Ç–æ–∂–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –≥—Ä–∞—Ñ–∏–∫, –µ—Å–ª–∏ –µ—Å—Ç—å
            if (charts.daily) {
                charts.daily.destroy();
            }
            
            charts.daily = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates.map(date => new Date(date).toLocaleDateString('ru-RU', { day: '2-digit', month: '2-digit' })),
                    datasets: [
                        {
                            label: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π',
                            data: bookingsCount,
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç',
                            data: seatsCount,
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            tension: 0.4,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ –ø–æ —Å–ª–æ—Ç–∞–º
        function createSlotsChart(labels, bookingsData, seatsData) {
            const ctx = document.getElementById('slotsChart').getContext('2d');
            
            if (charts.slots) {
                charts.slots.destroy();
            }
            
            charts.slots = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: bookingsData,
                        backgroundColor: [
                            'rgba(59, 130, 246, 0.8)',
                            'rgba(16, 185, 129, 0.8)',
                            'rgba(245, 158, 11, 0.8)'
                        ],
                        borderColor: [
                            '#3b82f6',
                            '#10b981',
                            '#f59e0b'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = bookingsData.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: ${value} –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –≥—Ä–∞—Ñ–∏–∫–∏
        function toggleCharts() {
            const chartsContainer = document.getElementById('charts-container');
            const isVisible = chartsContainer.style.display === 'grid';
            chartsContainer.style.display = isVisible ? 'none' : 'grid';
            
            if (!isVisible) {
                loadChartsData();
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
        function updateLastUpdateTime() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('ru-RU', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('last-update').textContent = timeStr;
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
        function showMessage(text, type) {
            const messageEl = document.getElementById('message');
            messageEl.textContent = text;
            messageEl.className = `message ${type}`;
            messageEl.style.display = 'block';
            
            if (type === 'success') {
                setTimeout(() => {
                    messageEl.style.display = 'none';
                }, 5000);
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É
        function showLoading(show) {
            const table = document.getElementById('bookings-table');
            if (show) {
                table.style.opacity = '0.5';
                table.style.pointerEvents = 'none';
            } else {
                table.style.opacity = '1';
                table.style.pointerEvents = 'auto';
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
        function refreshData() {
            currentPage = 1;
            loadData();
            showMessage('–î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã', 'success');
        }

        // –í—ã–±–æ—Ä –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π
        function toggleSelectAll(checkbox) {
            const checkboxes = document.querySelectorAll('.booking-checkbox');
            checkboxes.forEach(cb => {
                cb.checked = checkbox.checked;
            });
            updateDeleteButton();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–Ω–æ–ø–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è
        function updateDeleteButton() {
            const checkboxes = document.querySelectorAll('.booking-checkbox:checked');
            const deleteBtn = document.getElementById('delete-btn');
            deleteBtn.disabled = checkboxes.length === 0;
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
        async function deleteSelected() {
            const checkboxes = document.querySelectorAll('.booking-checkbox:checked');
            const ids = Array.from(checkboxes).map(cb => cb.value);
            
            if (!ids.length) return;
            
            if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å ${ids.length} –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π?`)) {
                return;
            }
            
            try {
                const { error } = await supabase
                    .from('bookings')
                    .delete()
                    .in('id', ids);
                
                if (error) throw error;
                
                showMessage(`–£—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–æ ${ids.length} –∑–∞–ø–∏—Å–µ–π`, 'success');
                refreshData();
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è:', error);
                showMessage(`–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ${error.message}`, 'error');
            }
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –æ–¥–Ω–æ–π –∑–∞–ø–∏—Å–∏
        async function deleteBooking(id) {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–ø–∏—Å—å?')) {
                return;
            }
            
            try {
                const { error } = await supabase
                    .from('bookings')
                    .delete()
                    .eq('id', id);
                
                if (error) throw error;
                
                showMessage('–ó–∞–ø–∏—Å—å —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞', 'success');
                refreshData();
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è:', error);
                showMessage(`–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ${error.message}`, 'error');
            }
        }

        // –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–ø–∏—Å–∏ (–∑–∞–≥–ª—É—à–∫–∞)
        function viewBooking(id) {
            alert('–ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª–µ–π –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è. ID: ' + id);
            // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –¥–µ—Ç–∞–ª—è–º–∏
        }

        // === –≠–ö–°–ü–û–†–¢ –û–¢–ß–ï–¢–û–í ===

        // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞
        function openExportModal() {
            document.getElementById('export-modal').style.display = 'flex';
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞
        function closeExportModal() {
            document.getElementById('export-modal').style.display = 'none';
        }

        // –í—ã–±–æ—Ä –æ–ø—Ü–∏–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞
        function selectExportOption(option) {
            selectedExportOption = option;
            
            // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö –æ–ø—Ü–∏–π
            document.querySelectorAll('.export-option').forEach(el => {
                el.classList.remove('active');
            });
            
            // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –æ–ø—Ü–∏—é
            event.currentTarget.classList.add('active');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –≤—ã–±–æ—Ä –¥–∞—Ç
            const datePicker = document.getElementById('date-range-picker');
            datePicker.style.display = option === 'custom' ? 'grid' : 'none';
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–∞—Ç—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–π –æ–ø—Ü–∏–∏
            const today = new Date();
            const exportDateFrom = document.getElementById('export-date-from');
            const exportDateTo = document.getElementById('export-date-to');
            
            switch(option) {
                case 'today':
                    exportDateFrom.value = formatDateForInput(today);
                    exportDateTo.value = formatDateForInput(today);
                    break;
                case 'week':
                    const weekAgo = new Date();
                    weekAgo.setDate(today.getDate() - 7);
                    exportDateFrom.value = formatDateForInput(weekAgo);
                    exportDateTo.value = formatDateForInput(today);
                    break;
                case 'month':
                    const monthAgo = new Date();
                    monthAgo.setMonth(today.getMonth() - 1);
                    exportDateFrom.value = formatDateForInput(monthAgo);
                    exportDateTo.value = formatDateForInput(today);
                    break;
                case '10days':
                    const tenDaysAgo = new Date();
                    tenDaysAgo.setDate(today.getDate() - 10);
                    exportDateFrom.value = formatDateForInput(tenDaysAgo);
                    exportDateTo.value = formatDateForInput(today);
                    break;
                case '3months':
                    const threeMonthsAgo = new Date();
                    threeMonthsAgo.setMonth(today.getMonth() - 3);
                    exportDateFrom.value = formatDateForInput(threeMonthsAgo);
                    exportDateTo.value = formatDateForInput(today);
                    break;
            }
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞
        async function generateExport() {
            try {
                const format = document.getElementById('export-format').value;
                const dateFrom = document.getElementById('export-date-from').value;
                const dateTo = document.getElementById('export-date-to').value;
                
                if (!dateFrom || !dateTo) {
                    showMessage('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—ã', 'error');
                    return;
                }
                
                // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥
                const { data, error } = await supabase
                    .from('bookings')
                    .select('*')
                    .gte('booking_date', dateFrom)
                    .lte('booking_date', dateTo)
                    .order('booking_date', { ascending: false });
                
                if (error) throw error;
                
                if (!data || data.length === 0) {
                    showMessage('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥', 'error');
                    return;
                }
                
                // –§–æ—Ä–º–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞
                const exportData = data.map(booking => ({
                    '–î–∞—Ç–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è': new Date(booking.booking_date).toLocaleDateString('ru-RU'),
                    '–í—Ä–µ–º–µ–Ω–Ω–æ–π —Å–ª–æ—Ç': getSlotName(booking.slot_time),
                    '–ö–æ–¥ –∞–≥–µ–Ω—Ç–∞': booking.agent_code,
                    '–ò–º—è –∞–≥–µ–Ω—Ç–∞': booking.agent_name,
                    '–¢–µ–ª–µ—Ñ–æ–Ω –∞–≥–µ–Ω—Ç–∞': booking.agent_phone,
                    '–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞': booking.client_name,
                    '–¢–µ–ª–µ—Ñ–æ–Ω –∫–ª–∏–µ–Ω—Ç–∞': booking.client_phone,
                    '–ê–¥—Ä–µ—Å –∫–ª–∏–µ–Ω—Ç–∞': booking.client_address || '',
                    '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç': booking.seats_count,
                    '–ü—Ä–∏–º–µ—á–∞–Ω–∏—è': booking.client_notes || '',
                    '–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è': new Date(booking.created_at).toLocaleString('ru-RU')
                }));
                
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ñ–∞–π–ª –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ñ–æ—Ä–º–∞—Ç–∞
                if (format === 'excel') {
                    exportToExcel(exportData, dateFrom, dateTo);
                } else if (format === 'csv') {
                    exportToCSV(exportData, dateFrom, dateTo);
                }
                
                closeExportModal();
                showMessage(`–û—Ç—á–µ—Ç —É—Å–ø–µ—à–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω (${data.length} –∑–∞–ø–∏—Å–µ–π)`, 'success');
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞:', error);
                showMessage(`–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: ${error.message}`, 'error');
            }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Å–ª–æ—Ç–∞
        function getSlotName(slotCode) {
            switch(slotCode) {
                case 'morning': return '–£—Ç—Ä–æ (9:00-12:00)';
                case 'afternoon': return '–î–µ–Ω—å (12:00-16:00)';
                case 'evening': return '–í–µ—á–µ—Ä (16:00-20:00)';
                default: return slotCode;
            }
        }

        // –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel
        function exportToExcel(data, dateFrom, dateTo) {
            const ws = XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, '–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è');
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
            const title = `–û—Ç—á–µ—Ç –ø–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è–º —Å ${dateFrom} –ø–æ ${dateTo}`;
            XLSX.utils.sheet_add_aoa(ws, [[title]], { origin: -1 });
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ñ–∞–π–ª
            const fileName = `–û—Ç—á–µ—Ç_–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è_${dateFrom}_${dateTo}.xlsx`;
            XLSX.writeFile(wb, fileName);
        }

        // –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV
        function exportToCSV(data, dateFrom, dateTo) {
            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –≤ CSV —Å—Ç—Ä–æ–∫—É
            const headers = Object.keys(data[0]).join(';');
            const rows = data.map(row => 
                Object.values(row).map(value => 
                    typeof value === 'string' && value.includes(';') ? `"${value}"` : value
                ).join(';')
            );
            
            const csvContent = [headers, ...rows].join('\n');
            
            // –°–æ–∑–¥–∞–µ–º –∏ —Å–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const fileName = `–û—Ç—á–µ—Ç_–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è_${dateFrom}_${dateTo}.csv`;
            saveAs(blob, fileName);
        }

        // –≠–∫—Å–ø–æ—Ä—Ç —Ç–µ–∫—É—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö (–∏–∑ —Ç–∞–±–ª–∏—Ü—ã)
        function exportCurrentData() {
            if (!filteredBookings || filteredBookings.length === 0) {
                showMessage('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞', 'error');
                return;
            }
            
            const exportData = filteredBookings.map(booking => ({
                '–î–∞—Ç–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è': new Date(booking.booking_date).toLocaleDateString('ru-RU'),
                '–í—Ä–µ–º–µ–Ω–Ω–æ–π —Å–ª–æ—Ç': getSlotName(booking.slot_time),
                '–ö–æ–¥ –∞–≥–µ–Ω—Ç–∞': booking.agent_code,
                '–ò–º—è –∞–≥–µ–Ω—Ç–∞': booking.agent_name,
                '–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞': booking.client_name,
                '–¢–µ–ª–µ—Ñ–æ–Ω –∫–ª–∏–µ–Ω—Ç–∞': booking.client_phone,
                '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç': booking.seats_count,
                '–ü—Ä–∏–º–µ—á–∞–Ω–∏—è': booking.client_notes || '',
                '–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è': new Date(booking.created_at).toLocaleString('ru-RU')
            }));
            
            const dateFrom = document.getElementById('filter-date-from').value;
            const dateTo = document.getElementById('filter-date-to').value;
            
            exportToExcel(exportData, dateFrom, dateTo);
            showMessage(`–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ${filteredBookings.length} –∑–∞–ø–∏—Å–µ–π`, 'success');
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
        setInterval(() => {
            if (document.getElementById('status-dot').className.includes('connected')) {
                refreshData();
            }
        }, 30000);

        // –í—ã–¥–µ–ª—è–µ–º –ø–µ—Ä–≤—É—é –æ–ø—Ü–∏—é —ç–∫—Å–ø–æ—Ä—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        window.addEventListener('load', () => {
            setTimeout(() => {
                document.querySelector('.export-option').click();
            }, 100);
        });
    </script>
</body>
</html>
